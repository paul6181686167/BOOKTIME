# üöÄ CRON CONFIGURATION ULTRA HARVEST PRODUCTION
# Fichier: /etc/crontab ou crontab -e
# 
# Ex√©cution automatique Ultra Harvest chaque dimanche √† 2h UTC
# Configuration optimis√©e pour production avec rate limiting

# Format: minute heure jour mois jour_semaine commande
# 0 2 * * 0 = Dimanche 2h du matin UTC

# Ultra Harvest Weekly - Production
0 2 * * 0 cd /app && /app/scripts/weekly_ultra_harvest.sh >> /app/logs/cron_ultra_harvest.log 2>&1

# Monitoring quotidien - V√©rification sant√© syst√®me
0 6 * * * cd /app/backend/scripts && python ultra_harvest_100k_tracking.py --stats >> /app/logs/daily_stats.log 2>&1

# Nettoyage mensuel - Logs et fichiers temporaires  
0 3 1 * * find /app/logs -name "*.log" -mtime +60 -delete && find /app/data -name "*backup*" -mtime +30 -delete

# ====================================
# INSTRUCTIONS D√âPLOIEMENT PAR PLATEFORME
# ====================================

# 1. RAILWAY
# ----------
# Ajouter dans railway.toml:
# [build]
# command = "chmod +x /app/scripts/weekly_ultra_harvest.sh"
#
# [deploy] 
# variables = [
#   "ULTRA_HARVEST_ENABLED=true",
#   "CRON_SCHEDULE=0 2 * * 0"
# ]

# 2. KUBERNETES
# -------------
# Utiliser CronJob resource:
# apiVersion: batch/v1
# kind: CronJob
# metadata:
#   name: ultra-harvest-weekly
# spec:
#   schedule: "0 2 * * 0"
#   jobTemplate:
#     spec:
#       template:
#         spec:
#           containers:
#           - name: ultra-harvest
#             image: booktime:latest
#             command: ["/app/scripts/weekly_ultra_harvest.sh"]

# 3. DOCKER COMPOSE
# -----------------
# version: '3.8'
# services:
#   booktime-cron:
#     image: booktime:latest
#     command: crond -f
#     volumes:
#       - ./crontab:/etc/crontabs/root
#       - ./data:/app/data
#       - ./logs:/app/logs

# 4. VERCEL (Frontend uniquement)
# --------------------------------
# Utiliser Vercel Cron Jobs (Beta) ou webhook externe:
# export default function handler(req, res) {
#   // Trigger Ultra Harvest via webhook
#   // N√©cessite backend s√©par√© (Railway/etc)
# }

# ====================================
# MONITORING ET ALERTES
# ====================================

# Script monitoring personnalis√© (optionnel)
# 0 8 * * 1 cd /app && python scripts/monitor_ultra_harvest_weekly.py

# Alerte email si √©chec (avec sendmail configur√©)
# 30 2 * * 0 if ! grep -q "‚úÖ Ultra Harvest Weekly r√©ussi" /app/logs/ultra_harvest_weekly_$(date +%Y%m%d)*.log; then echo "Ultra Harvest Failed" | mail -s "BOOKTIME Alert" admin@booktime.app; fi

# ====================================
# VARIABLES ENVIRONNEMENT PRODUCTION
# ====================================
# ULTRA_HARVEST_ENABLED=true
# ULTRA_HARVEST_TARGET=1000
# ULTRA_HARVEST_RATE_LIMIT=0.5  
# ULTRA_HARVEST_MAX_API_CALLS=100
# PRODUCTION_MODE=true
# LOG_LEVEL=INFO